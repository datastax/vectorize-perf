<html>
<head>
    <link rel="stylesheet" href="/styles.css">
    <script src="/script.js"></script>
</head>
<body>
    <div id="container">
        <div id="pane1" class="pane"></div>
        <div id="pane2" class="pane"></div>
    </div>
    <script async>
        function showWord(word, pane) {
            const drop = document.createElement("div");
            drop.classList.add("drop")
            drop.classList.add("word")
            drop.style.left = (pane === "left" ? 0 : 50) + Math.random() * 40 + "%";
            drop.style.animationDuration = (pane === "left" ? "2" : "4") + "s"
            drop.innerText = word
            document.getElementById((pane === "left" ? "pane1" : "pane2")).appendChild(drop)
        }



        const words = window.text.split(" ")

        async function runOpenAI(words) {
            for (word of words) {
                console.log("api call for ", word)
                const response = await fetch("/api/openai", {
                    method: "POST",
                    body: JSON.stringify({ word }),
                    headers: { "Content-type": "application/json; charset=UTF-8" }
                })
                const json = await response.json()
                console.log("showing ", json.word)
                showWord(json.word, "right")               
            }
        }

        async function runVectorize(words) {
            for (word of words) {
                console.log("api call for ", word)
                const response = await fetch("/api/vectorize", {
                    method: "POST",
                    body: JSON.stringify({ word }),
                    headers: { "Content-type": "application/json; charset=UTF-8" }
                })
                const json = await response.json()
                console.log("showing ", json.word)
                showWord(json.word, "left")               
            }
        }

        runOpenAI(words)

        runVectorize(words)

        //runVectorize()
    </script>
</body>
</html>