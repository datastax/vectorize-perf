<html>
<head>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div id="container">
        <div id="vectorize" class="pane">
            <div>
                <img src="/nvidia.svg" height="50px"/>
            </div>
            <div class="gauge-container">
                <canvas id="gauge-vectorize" width="250" height="200"></canvas>
            </div>
        </div>
        <div id="openai" class="pane">
            <div>
                <img src="/openai.svg" height="50px"/>
            </div>
            <div class="gauge-container">
                <canvas id="gauge-openai" width="250" height="200"></canvas>
            </div>
        </div>
    </div>
    <script>
        function showWord(word, version, duration) {
            const drop = document.createElement("div");
            drop.classList.add("drop")
            drop.classList.add("word")
            drop.classList.add(version)
            drop.style.left = (version === "vectorize" ? 0 : 50) + Math.random() * 40 + "%";
            drop.style.animationDuration = (duration * 10) + "ms"
            drop.innerText = word
            document.getElementById(version).appendChild(drop)
        }

        function calcSpeed(duration) {
            const values = durations
            const min = Math.min(...values)
            return (min / duration) * 100
        }

        async function run(words, version) {
            for (word of words) {
                const start = Date.now()
                console.log("api call for ", word)
                const response = await fetch(`/api/${ version }`, {
                    method: "POST",
                    body: JSON.stringify({ word }),
                    headers: { "Content-type": "application/json; charset=UTF-8" }
                })
                const json = await response.json()
                const end = Date.now()
                const duration = end - start
                console.log("showing ", version, json.word, duration)
                durations.push(duration)
                updateGauge(version, calcSpeed(duration))
                showWord(json.word, version, duration)               
            }
        }

        const durations = []

        window.onload = (event) => {
            console.log("page is fully loaded")
            const words = window.text.split(/\s/).filter(w => w.length > 0)
            run(words, "openai")
            run(words, "vectorize")
        }
    </script>
    <script src="/script.js"></script>
</body>
</html>